import{ab as _}from"./qeMyfMEq.js";import{t as J,a as g,z as B,l as E,b as z,T as D,f as j,i as W,m as x,s as C}from"./Bsbx6Kko.js";var N={0:"Drawing",1:"Hentai",2:"Neutral",3:"Porn",4:"Sexy"},v=function(s,n,t,r){function a(e){return e instanceof t?e:new t(function(u){u(e)})}return new(t||(t=Promise))(function(e,u){function o(c){try{i(r.next(c))}catch(h){u(h)}}function l(c){try{i(r.throw(c))}catch(h){u(h)}}function i(c){c.done?e(c.value):a(c.value).then(o,l)}i((r=r.apply(s,n||[])).next())})},m=function(s,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},r,a,e,u;return u={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function o(i){return function(c){return l([i,c])}}function l(i){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,i[0]&&(t=0)),t;)try{if(r=1,a&&(e=i[0]&2?a.return:i[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,i[1])).done)return e;switch(a=0,e&&(i=[i[0]&2,e.value]),i[0]){case 0:case 1:e=i;break;case 4:return t.label++,{value:i[1],done:!1};case 5:t.label++,a=i[1],i=[0];continue;case 7:i=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(i[0]===6||i[0]===2)){t=0;continue}if(i[0]===3&&(!e||i[1]>e[0]&&i[1]<e[3])){t.label=i[1];break}if(i[0]===6&&t.label<e[1]){t.label=e[1],e=i;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(i);break}e[2]&&t.ops.pop(),t.trys.pop();continue}i=n.call(s,t)}catch(c){i=[6,c],a=0}finally{r=e=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},b=function(s,n,t){if(t||arguments.length===2)for(var r=0,a=n.length,e;r<a;r++)(e||!(r in n))&&(e||(e=Array.prototype.slice.call(n,0,r)),e[r]=n[r]);return s.concat(e||Array.prototype.slice.call(n))},y={MobileNetV2:{path:"mobilenet_v2",numOfWeightBundles:1},MobileNetV2Mid:{path:"mobilenet_v2_mid",numOfWeightBundles:2,options:{type:"graph"}},InceptionV3:{path:"inception_v3",numOfWeightBundles:6,options:{size:299}}},F="MobileNetV2",w=224;function M(s){return!!s&&s in y}function T(s,n){return v(this,void 0,void 0,function(){var t,r,a=this;return m(this,function(e){switch(e.label){case 0:return t=b([],Array(n),!0).map(function(u,o){return v(a,void 0,void 0,function(){var l,i,c,h,d,p;return m(this,function(f){switch(f.label){case 0:l=o+1,i="group1-shard".concat(l,"of").concat(n),c=i.replace(/-/g,"_"),f.label=1;case 1:return f.trys.push([1,4,,5]),d=global[c],d?[3,3]:[4,_(()=>import("../models/".concat(s,"/").concat(i,".min.js")),[],import.meta.url)];case 2:d=f.sent().default,f.label=3;case 3:return h=d,[2,(p={},p[i]=h,p)];case 4:throw f.sent(),new Error("Could not load the weight data. Make sure you are importing the ".concat(i,".min.js bundle."));case 5:return[2]}})})}),[4,Promise.all(t)];case 1:return r=e.sent(),[2,Object.assign.apply(Object,b([{}],r,!1))]}})})}function O(s){return v(this,void 0,void 0,function(){var n,t,r,a,e,u,o;return m(this,function(l){switch(l.label){case 0:if(!M(s))return[2,s];n=y[s],t=n.path,r=n.numOfWeightBundles,l.label=1;case 1:return l.trys.push([1,4,,5]),e=global.model,e?[3,3]:[4,_(()=>import("../models/".concat(t,"/model.min.js")),[],import.meta.url)];case 2:e=l.sent().default,l.label=3;case 3:return a=e,[3,5];case 4:throw l.sent(),new Error("Could not load the model. Make sure you are importing the model.min.js bundle.");case 5:return[4,T(t,r)];case 6:return u=l.sent(),o=new k(a,u),[2,o]}})})}function H(s,n){var t;return n===void 0&&(n={size:w}),v(this,void 0,void 0,function(){var r,a;return m(this,function(e){switch(e.label){case 0:if(J==null)throw new Error("Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this model.");return s===void 0?(s=F,console.info("%cBy not specifying 'modelOrUrl' parameter, you're using the default model: '".concat(s,"'. See NSFWJS docs for instructions on hosting your own model (https://github.com/infinitered/nsfwjs?tab=readme-ov-file#host-your-own-model)."),"color: lightblue")):M(s)&&(console.info("%cYou're using the model: '".concat(s,"'. See NSFWJS docs for instructions on hosting your own model (https://github.com/infinitered/nsfwjs?tab=readme-ov-file#host-your-own-model)."),"color: lightblue"),n=(t=y[s].options)!==null&&t!==void 0?t:n),n.size=(n==null?void 0:n.size)||w,[4,O(s)];case 1:return r=e.sent(),a=new I(r,n),[4,a.load()];case 2:return e.sent(),[2,a]}})})}var k=function(){function s(n,t){this.modelJson=n,this.weightDataBase64=t}return s.prototype.arrayBufferFromBase64=function(n){for(var t=Buffer.from(n,"base64").toString("binary"),r=t.length,a=new Uint8Array(r),e=0;e<r;e++)a[e]=t.charCodeAt(e);return a.buffer},s.prototype.load=function(){return v(this,void 0,void 0,function(){var n,t,r,a,e,u,o,l,i,c,h,d,p,f;return m(this,function(V){if(n={modelTopology:this.modelJson.modelTopology,format:this.modelJson.format,generatedBy:this.modelJson.generatedBy,convertedBy:this.modelJson.convertedBy},this.modelJson.weightsManifest!=null){for(t=[],r=[],a=0,e=this.modelJson.weightsManifest;a<e.length;a++){for(u=e[a],o=0,l=u.paths;o<l.length;o++){if(i=l[o],c=this.weightDataBase64[i],!c)throw new Error("Could not find the weight data. Make sure you are importing the correct weight bundle for the model: ".concat(i,".min.js."));h=this.arrayBufferFromBase64(c),r.push(new Uint8Array(h))}t.push.apply(t,u.weights)}for(n.weightSpecs=t,d=new Uint8Array(r.reduce(function(S,A){return S+A.length},0)),p=0,f=0;f<r.length;f++)d.set(r[f],p),p+=r[f].byteLength;n.weightData=d.buffer}return this.modelJson.trainingConfig!=null&&(n.trainingConfig=this.modelJson.trainingConfig),this.modelJson.userDefinedMetadata!=null&&(n.userDefinedMetadata=this.modelJson.userDefinedMetadata),[2,n]})})},s}(),I=function(){function s(n,t){this.intermediateModels={},this.options=t,this.normalizationOffset=C(255),this.urlOrIOHandler=n,typeof n=="string"&&!n.startsWith("indexeddb://")&&!n.startsWith("localstorage://")&&!n.endsWith("model.json")?this.urlOrIOHandler="".concat(n,"model.json"):this.urlOrIOHandler=n}return s.prototype.load=function(){return v(this,void 0,void 0,function(){var n,t,r,a,e,u,o=this;return m(this,function(l){switch(l.label){case 0:return n=this.options,t=n.size,r=n.type,r!=="graph"?[3,2]:(a=this,[4,z(this.urlOrIOHandler)]);case 1:return a.model=l.sent(),[3,4];case 2:return e=this,[4,E(this.urlOrIOHandler)];case 3:e.model=l.sent(),this.endpoints=this.model.layers.map(function(i){return i.name}),l.label=4;case 4:return u=g(function(){return o.model.predict(B([1,t,t,3]))}),[4,u.data()];case 5:return l.sent(),u.dispose(),[2]}})})},s.prototype.infer=function(n,t){var r=this;if(t!=null&&this.endpoints.indexOf(t)===-1)throw new Error("Unknown endpoint ".concat(t,". Available endpoints: ").concat(this.endpoints,"."));return g(function(){n instanceof D||(n=j(n));var a=n.toFloat().div(r.normalizationOffset),e=a,u=r.options.size;if(n.shape[0]!==u||n.shape[1]!==u){var o=!0;e=W.resizeBilinear(a,[u,u],o)}var l=e.reshape([1,u,u,3]),i;if(t==null)i=r.model;else{if(r.model.hasOwnProperty("layers")&&r.intermediateModels[t]==null){var c=r.model.layers.find(function(h){return h.name===t});r.intermediateModels[t]=x({inputs:r.model.inputs,outputs:c.output})}i=r.intermediateModels[t]}return i.predict(l)})},s.prototype.classify=function(n,t){return t===void 0&&(t=5),v(this,void 0,void 0,function(){var r,a;return m(this,function(e){switch(e.label){case 0:return r=this.infer(n),[4,L(r,t)];case 1:return a=e.sent(),r.dispose(),[2,a]}})})},s}();function L(s,n){return v(this,void 0,void 0,function(){var t,r,o,a,e,o,u,o;return m(this,function(l){switch(l.label){case 0:return[4,s.data()];case 1:for(t=l.sent(),r=[],o=0;o<t.length;o++)r.push({value:t[o],index:o});for(r.sort(function(i,c){return c.value-i.value}),a=new Float32Array(n),e=new Int32Array(n),o=0;o<n;o++)a[o]=r[o].value,e[o]=r[o].index;for(u=[],o=0;o<e.length;o++)u.push({className:N[e[o]],probability:a[o]});return[2,u]}})})}export{I as NSFWJS,H as load};
